@using KaxServer.Services
<div class="profile-section">
    <h2 class="section-title-main">
        <span class="material-icons" style="vertical-align: middle;">storefront</span>
        Mod市场
    </h2>
    <p class="section-desc-main">探索、搜索和安装最新的Mod扩展</p>

    <div class="settings-section">
        <h3 class="section-title">搜索与筛选</h3>
        <div class="form-group" style="max-width:440px;">
            <form method="get">
                <div class="input-wrapper">
                    <span class="material-icons input-icon">search</span>
                    <input type="text" name="searchTerm" class="form-control with-icon" placeholder="搜索Mod、作者或标签..." value="@searchTerm" />
                    <button type="submit" class="btn-search-modern">
                        <span class="material-icons" style="vertical-align:middle;font-size:1.2em;">search</span>
                        搜索
                    </button>
                </div>
            </form>
    </div>

        @{
            var allItems = StoreManager.GetAllStoreItemsAsync().Result;
            var filteredItems = string.IsNullOrWhiteSpace(searchTerm)
                ? allItems
                : allItems.Where(item =>
                    (item.Title?.Contains(searchTerm, StringComparison.OrdinalIgnoreCase) ?? false) ||
                    (item.Description?.Contains(searchTerm, StringComparison.OrdinalIgnoreCase) ?? false)
                ).ToList();
        }
        @if (filteredItems.Count <= 0)
        {
            <h3>模组(0)</h3>
            <div class="not-found">
                <h4>什么都没有发现呢...</h4>
            </div>
        }
        else
        {
            <h3>模组(@filteredItems.Count)</h3>
            <div class="mod-item-container">
                @foreach (var item in filteredItems)
                {
                    <a class="mod-item-card" href="/Store/Detail?id=@item.Id" style="text-decoration:none; color:inherit;">
                        <div class="mod-item-card-header">
                            <div class="mod-item-card-icon">
                                <img src="@(string.IsNullOrWhiteSpace(item.Image) ? "https://upload.wikimedia.org/wikipedia/zh/9/94/Genshin_Impact.jpg" : item.Image)" alt="Mod图片">
                            </div>
                            <div class="mod-item-card-info">
                                <h4 class="mod-item-card-title">@item.Title</h4>
                                <div style="display: flex; gap: 0.0rem; align-items: center;">
                                    <p>@item.DownloadCount</p>
                                    <p class="material-icons" style="vertical-align: middle; font-size: 1.0rem; margin-left: 0.10rem; margin-top:0.1rem;">download</p>
                                    <span style="border-left:0.1px solid #444444;height:15px;display:inline-block;margin:0 8px;"></span>
                                    <p>@item.Rating</p>
                                    <p class="material-icons" style="vertical-align: middle; font-size: 1.0rem; margin-left: 0.10rem; margin-top:0.0rem;">star</p>
                                </div>
                            </div>
                            <div class="mod-item-card-price">
                                <p>@item.StoreItemPrices[0].Price</p>
                                <p class="material-icons" style="vertical-align: middle; font-size: 1.0rem; margin-left: 0.5rem; margin-top:0.12rem;">monetization_on</p>
                            </div>
                        </div>
                        <p style="margin-top: -0.5rem; margin-bottom: 0.5rem ; margin-left: 1.1rem; color: var(--secondary-color); font-size: 0.8rem;">@item.Description</p>
                    </a>
                }
            </div>
        }
</div>
<script src="https://cdn.jsdelivr.net/npm/colorthief@2.3.2/dist/color-thief.umd.js"></script>

@functions {
    public string searchTerm => Context.Request.Query["searchTerm"].ToString();
}
    </div>
</div>

<style>
    div > p{
        margin: 0;
    }
    .not-found {
        text-align: center;
        padding: 2rem;
        color: var(--secondary-color);
    }
    .mod-item-container {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
    }
    .mod-item-card{
        cursor: pointer;
        width: 264px;
        height: auto;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-color);
        transition: all 0.2s ease;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: var(--card-shadow);
    }

    .mod-item-card:hover{
        transform: translateY(-2px);
        border-color: #505050;
    }

    .mod-item-card-header{
        display: flex;
        margin: 1.0rem;
    }
    .mod-item-card-icon{
        width: 55px;
        height: 55px;
        border-radius: 0.8rem;
        background-color: #2c2c2c;
        margin-right: 1.0rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #3a3b3c;
    }
    .mod-item-card-icon img{
        border-radius: 8px;
        width: 75%;
        height: auto;
        display: block;
    }
    .mod-item-card-info{
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .mod-item-card-title{
        font-size: 1.0rem;
        font-weight: 600;
        color: #ffffff;
        margin: 0;
    }
    .mod-item-card-info{
        font-size: 0.9rem;
        color: var(--secondary-color);
        margin: 0;
    }
    .mod-item-card-price{
        display: flex;
        gap: 0.0rem;
        align-items: center;
        justify-content: center;
        height: 30px;
        width: auto;
        padding: 0.0rem 0.5rem;
        background-color: #313131;
        border-radius: 50rem;
        border: 1px solid #3a3b3c;
    }

    .mod-item-card-img{
        width: 100%;
        height: auto;
        display: block;
    }


    .btn-primary{
        height: 1.8rem;
        padding: 0.0rem 1.5rem;
    }
</style>
<style>
    .input-wrapper {
        display: flex;
        align-items: center;
        position: relative;
        padding: 0;
        background: none;
        border-radius: 4px;
        border: 1px solid var(--border-color, #444);
        overflow: hidden;
        height: 2.5rem;
    }
    .input-wrapper .input-icon {
        position: absolute;
        left: 12px;
        pointer-events: none;
        color: #888;
        z-index: 2;
    }
    .input-wrapper input.with-icon {
        padding-left: 2.2em;
        border: none;
        border-radius: 0;
        flex: 1;
        min-width: 0;
        height: 100%;
        background: transparent;
        color: #fff;
        outline: none;
        box-shadow: none;
    }
    .btn-search-modern {
        border-radius: 0px 4px 0px 0px;
        height: 2.5rem;
        padding: 0 1.5rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 1rem;
        font-weight: 600;
        background: linear-gradient(90deg, #4f8cff 0%, #6a5af9 100%);
        color: #fff;
        border: none;
        box-shadow: 0 2px 12px 0 rgba(80,120,255,0.18), 0 1.5px 4px 0 rgba(80,80,80,0.10);
        transition: all 0.18s cubic-bezier(.4,0,.2,1);
        cursor: pointer;
        outline: none;
        position: relative;
        z-index: 2;
    }
    .input-wrapper input.with-icon:focus {
        background: rgba(255,255,255,0.04);
    }
</style>