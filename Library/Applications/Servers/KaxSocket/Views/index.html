<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KaxHub - æ¸¸æˆæ¨¡ç»„å¹³å°ï¼ˆå¼€å‘ä¸­ï¼‰</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #0f0f0f;
            color: #ffffff;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .hero-content {
            max-width: 700px;
            padding: 0 20px;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            letter-spacing: -1px;
            color: #ffffff;
        }

        .hero p {
            font-size: 1.1rem;
            margin-bottom: 2.5rem;
            opacity: 0.75;
            line-height: 1.7;
            font-weight: 300;
        }

        .cta-button {
            display: inline-block;
            padding: 12px 32px;
            background: #ffffff;
            color: #0f0f0f;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.15s ease;
            border: 1px solid #ffffff;
        }

        .cta-button:hover {
            background: transparent;
            color: #ffffff;
        }

        /* æ–°å¢ï¼šç¦ç”¨çŠ¶æ€æ ·å¼ï¼Œä½¿ç”¨ pointer-events é˜»æ­¢ç‚¹å‡»å¹¶é™ä½å¯è§æ€§ */
        .cta-button.kax-disabled {
            pointer-events: none;
            opacity: 0.6;
            cursor: default;
        }

        .features {
            padding: 100px 20px;
            background: #0f0f0f;
        }

        .features h2 {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 4rem;
            color: #ffffff;
            font-weight: 600;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 3rem;
            max-width: 1100px;
            margin: 0 auto;
        }

        .feature-card {
            padding: 2rem;
            text-align: center;
            transition: all 0.25s ease;
            border-left: 3px solid rgba(255, 255, 255, 0);
        }

        .feature-card:hover {
            border-left-color: #ffffff;
            transform: translateX(5px);
        }

        .feature-icon {
            font-size: 2.2rem;
            margin-bottom: 1rem;
            display: block;
            opacity: 0.85;
        }

        .feature-card h3 {
            font-size: 1.15rem;
            margin-bottom: 0.6rem;
            color: #ffffff;
            font-weight: 600;
        }

        .feature-card p {
            opacity: 0.65;
            line-height: 1.6;
            font-size: 0.95rem;
            font-weight: 300;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.2rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .features h2 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>

<body>
    <section class="hero">
        <div class="hero-content">
            <h1>KaxHub <span style="font-size:0.6rem; opacity:0.7; margin-left:10px; font-weight:400;">å¼€å‘ä¸­</span>
            </h1>
            <p>ä¸€ä¸ªé¢å‘æ¸¸æˆæ¨¡ç»„çš„ç®¡ç†ä¸åˆ†å‘å¹³å°ï¼Œå½“å‰å¤„äºå¼€å‘é˜¶æ®µï¼ŒåŠŸèƒ½æœ‰é™ã€‚æ¬¢è¿å‚ä¸æµ‹è¯•ä¸åé¦ˆã€‚</p>
            <!-- ä¿®æ”¹ï¼šä¿ç•™ a æ ‡ç­¾ä½†å¢åŠ æ— éšœç¢å±æ€§ï¼Œè„šæœ¬å°†é€šè¿‡ç±»å’Œ aria-disabled ç®¡ç†ç¦ç”¨çŠ¶æ€ -->
            <a href="login" class="cta-button" id="joinBtn" role="button" aria-disabled="false">åŠ å…¥æµ‹è¯•</a>
        </div>
    </section>

    <section class="features" id="features">
        <h2>å½“å‰åŠŸèƒ½ï¼ˆå¼€å‘ä¸­ï¼‰</h2>
        <div class="features-grid">
            <div class="feature-card">
                <span class="feature-icon">ğŸ“‚</span>
                <h3>Mod æµè§ˆ</h3>
                <p>æµè§ˆä¸æŸ¥çœ‹å¯ç”¨æ¨¡ç»„çš„åŸºæœ¬ä¿¡æ¯ä¸ç‰ˆæœ¬è¯´æ˜ã€‚</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">â¬‡ï¸</span>
                <h3>Mod å®‰è£…</h3>
                <p>æ”¯æŒç®€å•çš„å®‰è£…æµç¨‹ï¼ˆå½“å‰ä¸ºæ‰‹åŠ¨/åŠè‡ªåŠ¨å®‰è£…ï¼Œåç»­ä¼šå®Œå–„ï¼‰ã€‚</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">ğŸ§©</span>
                <h3>æ¨¡ç»„ç®¡ç†</h3>
                <p>å¯ç”¨/ç¦ç”¨ä¸ç‰ˆæœ¬åˆ‡æ¢çš„åŸºç¡€ç®¡ç†åŠŸèƒ½ã€‚</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">ğŸ’¬</span>
                <h3>ç¤¾åŒºä¸åé¦ˆ</h3>
                <p>æä¾›åé¦ˆé€šé“ï¼Œæ”¶é›†ç”¨æˆ·å»ºè®®ä»¥ä¼˜å…ˆå®Œå–„æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">ğŸ”’</span>
                <h3>å…¼å®¹æ€§æ£€æŸ¥</h3>
                <p>åŸºç¡€çš„æ¨¡ç»„å…¼å®¹æç¤ºï¼Œå¸®åŠ©é¿å…å¸¸è§å†²çªï¼ˆé€æ­¥å¢å¼ºï¼‰ã€‚</p>
            </div>
            <div class="feature-card">
                <span class="feature-icon">â³</span>
                <h3>æ›´å¤šåŠŸèƒ½ï¼ˆå³å°†æ¨å‡ºï¼‰</h3>
                <p>äº‘ç«¯åŒæ­¥ã€è‡ªåŠ¨å®‰è£…å™¨ã€æ¨¡ç»„å¸‚åœºç­‰åŠŸèƒ½æ­£åœ¨è§„åˆ’ä¸­ã€‚</p>
            </div>
        </div>
    </section>

    <footer
        style="padding:24px 20px; text-align:center; color:rgba(255,255,255,0.6); font-size:0.9rem; border-top:1px solid rgba(255,255,255,0.04);">
        å¼€å‘ä¸­ â€¢ åŠŸèƒ½æœ‰é™ â€” æ¬¢è¿åœ¨ GitHub æäº¤é—®é¢˜ä¸å»ºè®®ï¼ˆ<a href="#" style="color:inherit; text-decoration:underline;">ä»“åº“</a>ï¼‰ã€‚
    </footer>

    <script>
        // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
    <script>
        // å¦‚æœæœ¬åœ°å­˜å‚¨ä¸­å­˜åœ¨ç™»å½• tokenï¼Œåˆ™ç‚¹å‡»â€œåŠ å…¥æµ‹è¯•â€ä¸å†è·³è½¬åˆ°ç™»å½•é¡µ
        (function () {
            var btn = document.getElementById('joinBtn');
            if (!btn) return;

            /**
             * è®¾ç½®æŒ‰é’®ç¦ç”¨çŠ¶æ€ï¼ˆå…¼å®¹ <a> å…ƒç´ ï¼‰
             * @param {HTMLElement} el - æŒ‰é’®å…ƒç´ 
             * @param {boolean} disabled - æ˜¯å¦ç¦ç”¨
             */
            function setBtnDisabled(el, disabled) {
                // ...ä¸­æ–‡æ³¨é‡Šï¼šå°†ç¦ç”¨çŠ¶æ€ä»¥ç±»å’Œ aria å±æ€§è¡¨ç¤ºï¼Œé¿å…ä½¿ç”¨ el.disabledï¼ˆ<a> ä¸æ”¯æŒï¼‰
                if (disabled) {
                    el.classList.add('kax-disabled');
                    el.setAttribute('aria-disabled', 'true');
                    el.setAttribute('tabindex', '-1');
                } else {
                    el.classList.remove('kax-disabled');
                    el.setAttribute('aria-disabled', 'false');
                    el.removeAttribute('tabindex');
                }
            }

            btn.addEventListener('click', async function (e) {
                // æ§åˆ¶ä½ï¼šåœ¨æŸäº›åˆ†æ”¯ï¼ˆä¾‹å¦‚ 429 å€’è®¡æ—¶ï¼‰ä¸‹ï¼Œé˜»æ­¢ finally å°†æŒ‰é’®æ¢å¤ä¸ºå¯ç”¨çŠ¶æ€
                var keepDisabled = false;
                try {
                    // è‹¥æŒ‰é’®ç”±å‰ç«¯æ ‡è®°ä¸ºç¦ç”¨ï¼Œåˆ™é˜»æ­¢ä¸€åˆ‡è¡Œä¸ºï¼Œé¿å…é‡å¤è§¦å‘æˆ–è·³è½¬
                    if (btn.classList.contains('kax-disabled') || btn.getAttribute('aria-disabled') === 'true') {
                        e.preventDefault();
                        return;
                    }

                    var token = localStorage.getItem('kax_login_token');
                    if (!token) {
                        // æ—  tokenï¼šä¿æŒé»˜è®¤è·³è½¬åˆ°ç™»å½•é¡µ
                        return;
                    }

                    // é˜»æ­¢é»˜è®¤è·³è½¬ï¼Œå…ˆéªŒè¯ token æ˜¯å¦æœ‰æ•ˆ
                    e.preventDefault();
                    var originalText = btn.textContent;
                    btn.textContent = 'éªŒè¯ä¸­...';
                    setBtnDisabled(btn, true);

                    // ä½¿ç”¨ AbortController æä¾›è¶…æ—¶ä¿æŠ¤
                    var controller = new AbortController();
                    var timeoutId = setTimeout(function () { controller.abort(); }, 8000);

                    var resp = await fetch('/api/token/test', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + token
                        },
                        signal: controller.signal,
                    });
                    clearTimeout(timeoutId);

                    if (resp.status === 200) {
                        // token æœ‰æ•ˆï¼šæ»šåŠ¨åˆ°åŠŸèƒ½åŒº
                        var features = document.getElementById('features');
                        if (features) { features.scrollIntoView({ behavior: 'smooth' }); }
                        else { alert('æ£€æµ‹åˆ°æ‚¨å·²ç™»å½•ï¼Œå·²ä¸ºæ‚¨ä¿ç•™åœ¨å½“å‰é¡µé¢ã€‚'); }
                        return;
                    }

                    // é€Ÿç‡é™åˆ¶ï¼ˆè¯·æ±‚è¿‡äºé¢‘ç¹ï¼‰ï¼Œä¸æ¸…é™¤ token ä¹Ÿä¸è·³è½¬ç™»å½•ï¼Œæç¤ºç”¨æˆ·å¹¶åœ¨å‰ç«¯çŸ­æš‚ç¦ç”¨æ“ä½œæŒ‰é’®
                    if (resp.status === 429) {
                        try {
                            // è§£æ Retry-After å¤´ï¼ˆå¯èƒ½ä¸ºç§’æ•°æˆ– HTTP æ—¥æœŸï¼‰ï¼Œæˆ–å°è¯•ä»å“åº”ä½“è¯»å–é‡è¯•ç§’æ•°
                            var retrySeconds = 60; // é»˜è®¤ç­‰å¾… 60 ç§’
                            var ra = resp.headers.get('Retry-After');
                            if (ra) {
                                var n = parseInt(ra, 10);
                                if (!isNaN(n)) {
                                    retrySeconds = n;
                                } else {
                                    var t = Date.parse(ra);
                                    if (!isNaN(t)) {
                                        retrySeconds = Math.max(1, Math.ceil((t - Date.now()) / 1000));
                                    }
                                }
                            } else {
                                try {
                                    var body = await resp.json();
                                    if (body) {
                                        if (body.retry_after) {
                                            var rn = parseInt(body.retry_after, 10);
                                            if (!isNaN(rn)) retrySeconds = rn;
                                        }
                                        // è®°å½•æœåŠ¡å™¨æç¤ºä»¥ä¾¿è°ƒè¯•
                                        if (body.message) console.warn('æœåŠ¡å™¨æç¤ºï¼š', body.message);
                                    }
                                } catch (_) { /* é JSON å“åº”æˆ–è§£æå¤±è´¥ï¼Œä¿æŒé»˜è®¤ */ }
                            }

                            // å‰ç«¯ç”¨æˆ·æç¤ºï¼Œä¸æ¸…é™¤ tokenã€ä¸è·³è½¬ç™»å½•
                            alert('æ“ä½œè¿‡äºé¢‘ç¹ï¼Œè¯·åœ¨ ' + retrySeconds + ' ç§’åé‡è¯•ã€‚');
                            try {
                                // å°† keepDisabled æ ‡è®°ä¸º trueï¼Œå‘ŠçŸ¥ finally ä¸è¦æ¢å¤æŒ‰é’®
                                keepDisabled = true;
                                // ä¸´æ—¶ç¦æ­¢æŒ‰é’®å¹¶æ˜¾ç¤ºå€’è®¡æ—¶æç¤ºï¼ˆé˜²æ­¢ç”¨æˆ·é‡å¤è§¦å‘ï¼‰
                                setBtnDisabled(btn, true);
                                var remaining = retrySeconds;
                                var original = originalText;
                                btn.textContent = 'è¯·ç¨åé‡è¯• (' + remaining + 's)';
                                var intervalId = setInterval(function () {
                                    remaining--;
                                    if (remaining <= 0) {
                                        clearInterval(intervalId);
                                        try { setBtnDisabled(btn, false); btn.textContent = original; } catch (_) { }
                                        // å€’è®¡æ—¶ç»“æŸï¼Œå…è®¸ finally åœ¨åç»­æ‰§è¡Œä¸­æ¢å¤æŒ‰é’®ï¼ˆå¦‚æœéœ€è¦ï¼‰
                                        keepDisabled = false;
                                    } else {
                                        try { btn.textContent = 'è¯·ç¨åé‡è¯• (' + remaining + 's)'; } catch (_) { }
                                    }
                                }, 1000);
                            } catch (_) { /* æŒ‰é’®æ›´æ–°å¤±è´¥ä¹Ÿä¸å½±å“ä¸»æµç¨‹ */ }
                        } catch (err429) {
                            console.error('å¤„ç† 429 å“åº”æ—¶å‡ºé”™ï¼š', err429);
                        }
                        return;
                    }

                    if (resp.status === 401) {
                        // token æ— æ•ˆæˆ–è¿‡æœŸï¼šæ¸…é™¤å¹¶è·³è½¬ç™»å½•
                        localStorage.removeItem('kax_login_token');
                        location.href = 'login';
                        return;
                    }

                    if (resp.status === 403) {
                        // è¢«å°ç¦æˆ–æ— æƒé™
                        try { var j = await resp.json(); if (j && j.message) alert(j.message); }
                        catch (_) { alert('æ‚¨çš„è´¦å·æ— æ³•è®¿é—®æ­¤èµ„æºã€‚'); }
                        localStorage.removeItem('kax_login_token');
                        location.href = 'login';
                        return;
                    }

                    // å…¶ä»–é 200 çš„å“åº”ï¼Œå°è¯•è¯»å–ä¿¡æ¯å¹¶æç¤ºï¼Œç„¶åè·³è½¬ç™»å½•ä»¥é‡æ–°è®¤è¯
                    try { var txt = await resp.text(); if (txt) console.warn('token test è¿”å›ï¼š', txt); }
                    catch (_) { }
                    localStorage.removeItem('kax_login_token');
                    location.href = 'login';

                } catch (err) {
                    // ç½‘ç»œé”™è¯¯æˆ–è¶…æ—¶ï¼šæ¸…ç† token å¹¶è·³è½¬ç™»å½•ä»¥ä¿è¯ä¸€è‡´æ€§
                    console.error('éªŒè¯ç™»å½•ä»¤ç‰Œæ—¶å‡ºé”™', err);
                    try { localStorage.removeItem('kax_login_token'); } catch (_) { }
                    // è‹¥æ˜¯è¢«ä¸­æ–­(è¶…æ—¶)ï¼Œä¸ºç”¨æˆ·æä¾›æç¤º
                    alert('æ— æ³•éªŒè¯ç™»å½•çŠ¶æ€ï¼Œè¯·é‡æ–°ç™»å½•ã€‚');
                    location.href = 'login';
                } finally {
                    // ä»…åœ¨æœªè¢« 429 å¤„ç†é€»è¾‘æ ‡è®°ä¸ºé•¿æœŸç¦ç”¨æ—¶æ¢å¤æŒ‰é’®
                    try {
                        if (!keepDisabled) {
                            setBtnDisabled(btn, false);
                            btn.textContent = originalText;
                        }
                    } catch (_) { }
                }
            });
        })();
    </script>
</body>

</html>