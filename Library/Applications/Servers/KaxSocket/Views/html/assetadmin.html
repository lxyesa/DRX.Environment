<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KaxHub - 资源控制台</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="/css/global.css" rel="stylesheet">
    <script src="/js/global.js" defer></script>
    <script src="/components/collapsible-card.js" defer></script>
    <link href="/css/assetadmin.css" rel="stylesheet">
</head>

<body class="has-global-topbar">
    <!-- 页面内容默认隐藏，直到完成登录验证 -->
    <div id="page" class="hidden">
        <div class="container">
            <header>
                <div class="brand">
                    <div class="logo">◆</div>
                    <div>
                        <h1>资源管理</h1>
                        <p class="lead">KaxHub 核心资源管理控制台</p>
                    </div>
                </div>
                <div class="controls">
                    <button id="homeBtn" class="btn ghost">返回首页</button>
                    <button id="logoutBtn" class="btn">登出</button>
                </div>
            </header>

            <div class="main-content">
                <!-- 左侧：资源列表 -->
                <div class="content-area">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">资源列表</h2>
                            <div class="filters">
                                <select id="sortSelect" class="btn ghost small" data-custom-select="true"
                                    aria-hidden="true" tabindex="-1"
                                    style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;">
                                    <option value="name">按名称排序</option>
                                    <option value="version">按版本排序</option>
                                    <option value="author">按作者排序</option>
                                    <option value="updated">按更新时间排序</option>
                                </select>
                                <!-- custom dropdown will be initialized from JS -->
                                <select id="statusFilter" class="btn ghost small" data-custom-select="true"
                                    aria-hidden="true" tabindex="-1"
                                    style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;">
                                    <option value="all">全部</option>
                                    <option value="active">活跃</option>
                                    <option value="deleted">已删除</option>
                                </select>
                                <!-- custom dropdown will be initialized from JS -->
                            </div>
                        </div>

                        <div class="search-section">
                            <div class="search-bar" role="search" aria-label="搜索资源">
                                <span class="search-icon material-icons" aria-hidden="true">search</span>
                                <input id="searchInput" class="search-input" type="text" placeholder="搜索名称/作者/版本/描述" />
                                <span id="searchSpinner" class="search-spinner" aria-hidden="true" title="搜索中"></span>
                            </div>
                        </div>

                        <div id="assetList" class="asset-list-container">
                            <p class="hint" style="text-align: center; padding: 40px 20px;">加载中...</p>
                        </div>

                        <div class="pagination">
                            <button id="prevPageBtn" class="btn ghost small">上一页</button>
                            <div id="pageInfo" class="page-info">第 1 页</div>
                            <button id="nextPageBtn" class="btn ghost small">下一页</button>
                        </div>
                    </div>
                </div>

                <!-- 右侧：创建和修改 -->
                <div class="sidebar">

                    <!-- 创建资源卡片 -->
                    <collapsible-card title="创建资源" subtitle="填写信息以创建新资源项目" open>
                        <span slot="icon" class="material-icons">add_box</span>
                        <form id="createAssetForm">
                            <label for="createName">资源名称</label>
                            <input type="text" id="createName" placeholder="例如: ModName" required>

                            <label for="createVersion" style="margin-top:12px;">版本</label>
                            <input type="text" id="createVersion" placeholder="例如: 1.0.0" required>

                            <label for="createAuthor" style="margin-top:12px;">作者</label>
                            <input type="text" id="createAuthor" placeholder="资源作者名称" required>

                            <label for="createDescription" style="margin-top:12px;">描述</label>
                            <textarea id="createDescription" placeholder="资源描述信息" rows="3"></textarea>

                            <label for="createStock" style="margin-top:12px;">库存</label>
                            <input type="text" id="createStock" placeholder="例如: 100" />

                            <label for="createCategory" style="margin-top:12px;">分类</label>
                            <input type="text" id="createCategory" placeholder="例如: 模组" />

                            <label for="createFileSize" style="margin-top:12px;">文件大小（字节）</label>
                            <input type="text" id="createFileSize" placeholder="例如: 1048576" />

                            <label for="createCompatibility" style="margin-top:12px;">兼容性</label>
                            <input type="text" id="createCompatibility" placeholder="例如: 1.16 - 1.20" />

                            <label for="createDownloads" style="margin-top:12px;">下载次数</label>
                            <input type="text" id="createDownloads" placeholder="例如: 1234" />

                            <label for="createUploadDate" style="margin-top:12px;">上传时间（Unix 秒）</label>
                            <input type="text" id="createUploadDate" placeholder="例如: 1670000000" />

                            <label for="createLicense" style="margin-top:12px;">许可证</label>
                            <input type="text" id="createLicense" placeholder="例如: MIT" />

                            <label for="createDownloadUrl" style="margin-top:12px;">下载地址</label>
                            <input type="text" id="createDownloadUrl" placeholder="例如: https://..." />

                            <button type="submit" class="btn" style="width: 100%; margin-top: 16px;">创建资源</button>
                        </form>
                    </collapsible-card>

                    <!-- 创建 CDK（快速） -->
                    <collapsible-card title="创建 CDK" subtitle="为选中资源快速创建 CDK">
                        <span slot="icon" class="material-icons">redeem</span>
                        <form id="createCdkForm">
                            <label for="cdkAssetId">AssetId *</label>
                            <input type="text" id="cdkAssetId" placeholder="使用列表已选资源ID（或手动填写）" />

                            <label for="cdkGoldValue" style="margin-top:12px;">金币（可选）</label>
                            <input type="text" id="cdkGoldValue" placeholder="0" value="0" />

                            <label style="margin-top:12px;">时效（可选，0表示永久）</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="text" id="cdkExpiresInValue" placeholder="时间量" value="0" style="flex: 1;" />
                                <select id="cdkExpiresInUnit" style="flex: 0 0 auto; width: 80px;" title="时效单位">
                                    <option value="0">永久</option>
                                    <option value="3600">小时</option>
                                    <option value="86400">天</option>
                                    <option value="604800">周</option>
                                    <option value="2592000">月</option>
                                </select>
                            </div>

                            <label for="cdkPrefix" style="margin-top:12px;">前缀（可选）</label>
                            <input type="text" id="cdkPrefix" placeholder="例如：CDK-" />

                            <label for="cdkCount" style="margin-top:12px;">生成数量</label>
                            <input type="text" id="cdkCount" placeholder="1 - 1000" value="10" />

                            <label for="cdkLength" style="margin-top:12px;">代码长度</label>
                            <input type="text" id="cdkLength" placeholder="4 - 256" value="8" />

                            <label for="cdkDesc" style="margin-top:12px;">描述（可选）</label>
                            <input type="text" id="cdkDesc" placeholder="为 CDK 添加描述" />

                            <div style="display:flex;gap:8px;margin-top:16px;">
                                <button type="submit" id="createCdkBtn" class="btn" style="flex:1;">生成并保存</button>
                                <button type="button" id="createCdkPreviewBtn" class="btn ghost" style="flex:1;">生成预览</button>
                            </div>

                            <label for="createCdkResult" style="margin-top:12px;">生成结果</label>
                            <textarea id="createCdkResult" readonly style="min-height:80px;" title="生成的CDK代码"></textarea>

                            <div style="display:flex;gap:8px;margin-top:8px;">
                                <button type="button" id="createCdkSaveBtn" class="btn" style="flex:1;">保存</button>
                                <button type="button" id="createCdkDownloadBtn" class="btn ghost" style="flex:1;">下载</button>
                            </div>
                        </form>
                    </collapsible-card>

                    <!-- 修改资源卡片 -->
                    <collapsible-card title="修改资源" subtitle="加载资源后编辑并提交更新">
                        <span slot="icon" class="material-icons">edit</span>
                        <form id="updateAssetForm">
                            <label for="updateAssetId">选择资源</label>
                            <div style="display: flex; gap: 8px; margin-bottom: 16px; align-items: center;">
                                <input type="text" id="updateAssetId" placeholder="资源ID" required style="flex: 1;">
                                <button type="button" id="loadAssetBtn" class="btn ghost small">加载</button>
                            </div>

                            <label for="updateName">资源名称</label>
                            <input type="text" id="updateName" placeholder="资源名称">

                            <label for="updateVersion" style="margin-top:12px;">版本</label>
                            <input type="text" id="updateVersion" placeholder="版本" required>

                            <label for="updateAuthor" style="margin-top:12px;">作者</label>
                            <input type="text" id="updateAuthor" placeholder="作者" required>

                            <label for="updateDescription" style="margin-top:12px;">描述</label>
                            <textarea id="updateDescription" placeholder="资源描述信息" rows="3"></textarea>

                            <label for="updateStock" style="margin-top:12px;">库存</label>
                            <input type="text" id="updateStock" placeholder="例如: 100" />

                            <label for="updateCategory" style="margin-top:12px;">分类</label>
                            <input type="text" id="updateCategory" placeholder="例如: 模组" />

                            <label for="updateFileSize" style="margin-top:12px;">文件大小（字节）</label>
                            <input type="text" id="updateFileSize" placeholder="例如: 1048576" />

                            <label for="updateCompatibility" style="margin-top:12px;">兼容性</label>
                            <input type="text" id="updateCompatibility" placeholder="例如: 1.16 - 1.20" />

                            <label for="updateDownloads" style="margin-top:12px;">下载次数</label>
                            <input type="text" id="updateDownloads" placeholder="例如: 1234" />

                            <label for="updateUploadDate" style="margin-top:12px;">上传时间（Unix 秒）</label>
                            <input type="text" id="updateUploadDate" placeholder="例如: 1670000000" />

                            <label for="updateLicense" style="margin-top:12px;">许可证</label>
                            <input type="text" id="updateLicense" placeholder="例如: MIT" />

                            <label for="updateDownloadUrl" style="margin-top:12px;">下载地址</label>
                            <input type="text" id="updateDownloadUrl" placeholder="例如: https://..." />

                            <button type="submit" class="btn" disabled id="updateBtn" style="width: 100%; margin-top: 16px;">更新资源</button>
                        </form>
                    </collapsible-card>

                    <!-- 价格计划管理卡片 -->
                    <collapsible-card title="价格计划" subtitle="管理资源的订阅套餐与定价">
                        <span slot="icon" class="material-icons">sell</span>

                        <div style="margin-bottom: 16px;">
                            <label>选择资源</label>
                            <div style="display: flex; gap: 8px; align-items: center; margin-top: 6px;">
                                <input type="text" id="priceAssetId" placeholder="资源ID" style="flex: 1;" readonly>
                                <button type="button" id="addPricePlanBtn" class="btn small">新增计划</button>
                            </div>
                        </div>

                        <div id="priceListContainer" style="margin-bottom: 16px;">
                            <label>现有计划</label>
                            <div id="priceList" class="price-list" style="margin-top:6px; max-height: 300px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.06); border-radius: 4px;">
                                <p class="hint" style="text-align: center; padding: 20px 0;">请先选择资源</p>
                            </div>
                        </div>

                        <form id="pricePlanForm" style="display: none;">
                            <input type="hidden" id="editingPriceId" value="">

                            <label for="planPrice">价格 *</label>
                            <input type="text" id="planPrice" placeholder="例如: 99.00" required>

                            <label for="planUnit" style="margin-top:12px;">时间单位 *</label>
                            <select id="planUnit" required>
                                <option value="once">一次性</option>
                                <option value="hour">小时</option>
                                <option value="day">天</option>
                                <option value="month">月</option>
                                <option value="year">年</option>
                            </select>

                            <div id="planDurationContainer">
                                <label for="planDuration" style="margin-top:12px;">持续时间 *</label>
                                <input type="text" id="planDuration" placeholder="例如: 1" required>
                            </div>

                            <label for="planOriginalPrice" style="margin-top:12px;">原始价格</label>
                            <input type="text" id="planOriginalPrice" placeholder="例如: 99.00">

                            <label for="planDiscountRate" style="margin-top:12px;">折扣率 (0.0-1.0)</label>
                            <input type="text" id="planDiscountRate" placeholder="例如: 0.20 表示 20%" value="0">

                            <label for="planSalePrice" style="margin-top:12px;">折后价</label>
                            <input type="text" id="planSalePrice" placeholder="自动计算" readonly>

                            <div style="display:flex;gap:8px;margin-top:16px;">
                                <button type="submit" class="btn" style="flex:1;">保存计划</button>
                                <button type="button" id="cancelPricePlanBtn" class="btn ghost" style="flex:1;">取消</button>
                            </div>
                        </form>
                    </collapsible-card>

                </div>
            </div>


        </div>
    </div>

    <!-- 详情面板 -->
    <div id="assetDetailBackdrop" aria-hidden="true"></div>
    <aside id="assetDetailPanel" aria-hidden="true" role="dialog" aria-labelledby="assetDetailTitle">
        <div class="panel-header">
            <h3 id="assetDetailTitle" class="panel-title">资源详情</h3>
            <button class="panel-close" id="closeDetailPanelBtn" aria-label="关闭">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div id="assetDetailContent">
            <!-- 动态内容 -->
        </div>
    </aside>

    <div id="loading"
        style="min-height:60vh;display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,0.7)">
    </div>

        <script src="/js/assetadmin.js"></script>
</body>

</html>