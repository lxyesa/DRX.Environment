<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KaxHub - 个人资料</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="/css/global.css" rel="stylesheet">
  <script src="/js/global.js" defer></script>
  <script src="/components/inputbox.js" defer></script>
  <script src="/components/badge/userbadge.js" defer></script>
  <link href="/css/profile.css" rel="stylesheet">
</head>

<body class="has-global-topbar">
  <div class="container">
    <!-- 错误页面 -->
    <div class="error-container" id="errorContainer">
      <div class="error-icon">⚠️</div>
      <div class="error-title">资料不存在</div>
      <div class="error-message">抱歉，你访问的用户资料不存在或已被删除。请检查 UID 是否正确。</div>
      <div class="error-actions">
        <button class="btn ghost" onclick="location.href='/'">返回首页</button>
        <button class="btn" onclick="location.href='/profile'">查看我的资料</button>
      </div>
    </div>

    <!-- 主要内容 -->
    <div id="mainContent">
      <div class="page-header" role="banner">
        <div class="brand">
          <div class="logo">◆</div>
          <div>
            <h1>个人资料</h1>
            <div class="lead">管理你的账户信息、偏好与安全设置</div>
          </div>
        </div>
        <div class="controls">
          <button class="btn ghost" id="backBtn">返回首页</button>
          <button class="btn" id="logoutBtn">登出</button>
        </div>
      </div>

      <main class="grid">
        <!-- 左侧：个人卡片 -->
        <aside class="card profile-card" aria-label="个人信息卡片">
          <div class="avatar" id="avatarContainer" title="上传头像（仅预览）" role="button" tabindex="0" aria-label="上传头像（仅预览）">
            <!-- 占位首字母 -->
            <img id="avatarImg" src="/static/default-avatar.jpg" alt="头像" onerror="this.style.display='none'">
            <span id="avatarInitials">YY</span>
            <!-- 悬停覆盖层 + 放大加号动画 -->
            <div class="avatar-overlay" aria-hidden="true"><span class="material-icons avatar-plus"
                aria-hidden="true">add</span></div>
            <!-- 隐藏文件输入（由头像触发） -->
            <input id="avatarFile" type="file" accept="image/*" style="display:none" aria-hidden="true">
          </div>

          <div class="profile-info" style="width:100%;">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-direction: column;">
              <div>
                <div class="name" id="displayName">杨 瑶</div>
                <div class="meta" id="displayHandle">@yangyao • 管理员</div>
                <div class="badge-container" aria-hidden="false">
                  <user-badge text="无徽章" variant="gray" aria-label="徽章：无"></user-badge>
                </div>
              </div>

              <div class="stats" aria-hidden="true">
                <div class="stat">
                  <span class="num" id="statResourceCount">0</span>
                  <span class="label">资源</span>
                </div>
                <div class="stat">
                  <span class="num" id="statGold">0</span>
                  <span class="label">金币</span>
                </div>
                <div class="stat">
                  <span class="num" id="statRecentActivity">0</span>
                  <span class="label">最近活动</span>
                </div>
              </div>

              <div style="margin-top:10px;">
                <div class="info-row">
                  <div class="k">邮箱</div>
                  <div class="v" id="email" title="yangyao@example.com">yangyao@example.com</div>
                </div>
                <div class="info-row">
                  <div class="k">角色</div>
                  <div class="v" id="role">管理员</div>
                </div>
                <div class="info-row">
                  <div class="k">UID</div>
                  <div class="v" id="uid">-</div>
                </div>
                <div class="info-row">
                  <div class="k">封禁</div>
                  <div class="v" id="banStatus">否</div>
                </div>
                <div class="info-row">
                  <div class="k">注册时间</div>
                  <div class="v" id="joined">2021-05-12</div>
                </div>
                <div class="info-row">
                  <div class="k">上次登录</div>
                  <div class="v" id="lastLogin">2026-02-17 09:12</div>
                </div>
                <div class="info-row">
                  <div class="k">金币</div>
                  <div class="v" id="gold">0</div>
                </div>
              </div>
            </div>
        </aside>

        <!-- 右侧：表单和设置 -->
        <section>
          <div class="card" aria-labelledby="basicTitle">
            <div class="section-title">
              <div style="display:flex;align-items:center;gap:8px;">
                <span class="material-icons" style="color:var(--accent);font-size:20px;">person</span>
                <h2 id="basicTitle" style="margin:0;font-size:1rem">基本信息</h2>
              </div>
              <div class="small-hint">已连接后端：保存将调用 /api/user/profile（需要登录）</div>
            </div>

            <form id="profileForm">
              <div class="form-grid">
                <div>
                  <input-box id="inputName" label="显示名称" placeholder="显示名称" value="杨 瑶"></input-box>
                </div>
                <div>
                  <input-box id="inputHandle" label="用户名" placeholder="用户名" value="yangyao" readonly
                    title="用户名不可修改"></input-box>
                </div>
                <div>
                  <input-box id="inputEmail" label="邮箱" placeholder="邮箱" type="email"
                    value="yangyao@example.com"></input-box>
                </div>
                <div>
                  <input-box id="inputRole" label="角色" placeholder="角色" value="管理员" readonly
                    title="由系统控制，无法修改"></input-box>
                </div>
              </div>

              <div style="margin-top:12px;">
                <label for="inputBio">个人简介</label>
                <textarea id="inputBio">热爱开发与产品，负责 KaxHub 平台的后端与管理功能。</textarea>
              </div>

              <div style="margin-top:12px;">
                <input-box id="inputSignature" label="个性签名" placeholder="输入个性签名" textarea rows="3"></input-box>
              </div>

              <div class="actions" style="justify-content:flex-end;">
                <button type="button" class="btn ghost" id="cancelBtn">取消</button>
                <button type="submit" class="btn primary" id="saveBtn">保存更改</button>
              </div>
            </form>
          </div>

          <div class="card" style="margin-top:12px;">
            <div class="section-title">
              <div style="display:flex;align-items:center;gap:8px;">
                <span class="material-icons" style="color:var(--accent);font-size:20px;">security</span>
                <h3 style="margin:0;font-size:1rem">安全与偏好</h3>
              </div>
              <div class="small-hint">密码与安全设置</div>
            </div>

            <div style="display:flex;gap:12px;flex-wrap:wrap;">
              <div style="flex:1;min-width:220px;">
                <label>更改密码</label>
                <div style="display:flex;gap:8px;flex-direction:column;">
                  <div style="display:flex;flex-direction:column;gap:6px;">
                    <input-box id="pwOld" label="当前密码" placeholder="当前密码" type="password" name="currentPassword"
                      autocomplete="current-password"></input-box>
                  </div>
                  <div style="display:flex;gap:8px;">
                    <div style="flex:1;display:flex;flex-direction:column;gap:6px;">
                      <input-box id="pw1" label="新密码" placeholder="新密码" type="password" name="newPassword" minlength="8"
                        autocomplete="new-password"></input-box>
                    </div>
                    <div style="flex:1;display:flex;flex-direction:column;gap:6px;">
                      <input-box id="pw2" label="确认新密码" placeholder="确认新密码" type="password" name="confirmPassword"
                        minlength="8" autocomplete="new-password"></input-box>
                    </div>
                  </div>
                </div>
                <div class="small-hint">密码长度至少 8 位</div>
                <div style="margin-top:8px;display:flex;justify-content:flex-end;">
                  <button class="btn" id="changePwBtn">更新密码</button>
                </div>
              </div>
            </div>
          </div>

          <!-- 激活资产列表板块 -->
          <div class="card" style="margin-top:12px;" aria-labelledby="activeAssetsTitle">
            <div class="section-title">
              <div style="display:flex;align-items:center;gap:8px;">
                <span class="material-icons" style="color:var(--accent);font-size:20px;">verified</span>
                <span id="activeAssetsTitle" style="font-weight:700;color:var(--muted-strong);">激活的资产</span>
              </div>
              <span id="assetsCount" style="font-size:0.9rem;color:var(--muted);">加载中...</span>
            </div>

            <div id="assetsContainer" style="max-height:400px;overflow-y:auto;padding-right:6px;border-radius:4px;">
              <div id="assetsLoading" style="text-align:center;color:var(--muted);padding:12px;font-size:0.95rem;">
                正在加载资产列表...
              </div>
              <div id="assetsEmpty"
                style="display:none;text-align:center;color:var(--muted);padding:12px;font-size:0.95rem;">
                暂无激活的资产
              </div>
              <div id="assetsList" style="display:flex;flex-direction:column;gap:8px;"></div>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <div class="section-title">
              <div style="display:flex;align-items:center;gap:8px;">
                <span class="material-icons" style="color:var(--accent);font-size:20px;">card_giftcard</span>
                <h3 style="margin:0;font-size:1rem">CDK 激活</h3>
              </div>
              <div class="small-hint">输入 CDK 代码激活资源</div>
            </div>

            <div style="display:flex;flex-direction:column;gap:12px;">
              <div style="display:flex;gap:8px;flex-direction:row;">
                <div style="flex:1;">
                  <input-box id="cdkInput" label="CDK 代码" placeholder="输入 CDK 代码" autocomplete="off"></input-box>
                </div>
                <div style="display:flex;align-items:flex-end;">
                  <button class="btn" id="activateCdkBtn" style="height:fit-content;padding:8px 16px;">激活</button>
                </div>
              </div>

              <div id="cdkMessage"
                style="display:none;padding:12px;border-radius:8px;font-size:0.95rem;border:1px solid;"></div>

              <div id="cdkResult"
                style="display:none;padding:12px;border-radius:8px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.3);">
                <div style="color:var(--success);font-weight:600;">✓ 激活成功</div>
                <div id="cdkResultDetails" style="color:var(--muted);font-size:0.9rem;margin-top:6px;"></div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- 弹出卡片：更变计划 -->
  <div class="modal-overlay" id="changePlanModal">
    <div class="modal-card">
      <div class="modal-header">
        <span class="material-icons icon">card_giftcard</span>
        <span>选择新套餐</span>
      </div>
      <div class="modal-body">
        <div id="planModalMessage"
          style="display:none;padding:8px 10px;border-radius:6px;background:rgba(239,68,68,0.1);color:var(--danger);font-size:0.9rem;margin-bottom:12px;">
        </div>
        <div id="planModalConfirm"
          style="display:none;padding:8px 10px;border-radius:6px;background:rgba(20,20,20,0.92);color:var(--muted-strong);font-size:0.9rem;margin-bottom:12px;">
          确认更变套餐将花费 <span id="planModalConfirmCost">💰0.00</span>，是否继续？
          <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end;">
            <button class="btn ghost" id="planModalConfirmNo">取消</button>
            <button class="btn" id="planModalConfirmYes">确认</button>
          </div>
        </div>
        当前资源 <strong id="planModalAssetName">-</strong>
        将更变为其他套餐。更变套餐不会继承上个套餐的剩余时常。
      </div>
      <div class="plan-list" id="planList">
        <!-- 套餐列表由JavaScript动态生成 -->
      </div>
      <div class="modal-footer">
        <button class="btn ghost" onclick="closePlanModal()">取消</button>
        <button class="btn" id="confirmChangePlanBtn">确认更变</button>
      </div>
    </div>
  </div>

  <!-- 弹出卡片：取消订阅 -->
  <div class="modal-overlay" id="unsubscribeModal">
    <div class="modal-card">
      <div class="modal-header">
        <span class="material-icons icon" style="color: var(--danger);">warning</span>
        <span>取消订阅</span>
      </div>
      <div class="modal-warning">
        <span class="material-icons icon">error_outline</span>
        <span>此操作不可撤销</span>
      </div>
      <div class="modal-body">
        你即将取消订阅资源 <strong id="unsubscribeModalAssetName">-</strong>。
        <br><br>
        取消订阅后，该资产将直接从你的已激活资产中移除。你将失去对该资源的访问权限。
      </div>
      <div class="modal-footer">
        <button class="btn ghost" onclick="closeUnsubscribeModal()">我想再想想</button>
        <button class="btn" style="background: var(--danger); border-color: var(--danger); color: #fff;"
          id="confirmUnsubscribeBtn">确认取消订阅</button>
      </div>
    </div>
  </div>

  <script src="/js/profile.js"></script>
</body>

</html>